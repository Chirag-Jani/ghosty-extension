Veil - Privacy-By-Default Solana Wallet Extension

What it is
----------
Veil is a non-custodial Solana browser extension wallet that makes privacy the default. It manages a single locally encrypted master seed and derives unlimited deterministic burner wallets from it so that dApps never see your main wallet.

Problem
-------
- Users don’t want to connect their primary wallet to random or untrusted dApps.
- Manually creating and managing burner wallets is painful and error-prone.
- Address reuse leaks identity by letting observers link on-chain activity across sites.

Core Idea
---------
- One encrypted master seed stored on the user’s device.
- From that seed, Veil deterministically derives site-bound, session-scoped burner wallets.
- Each burner is isolated per origin, recoverable from the master seed, and never reused once drained.
- dApps only ever interact with a burner wallet, not the master wallet.

Privacy Cash Mode (Privacy by Default)
--------------------------------------
- Privacy Cash mode is ON by default to match Veil’s “Privacy by Default” philosophy.
- Users can optionally turn Privacy Cash mode off in Settings if they want a simpler, normal wallet flow.
- When Privacy Cash mode is enabled (default):
  - Deposit: move funds from burner wallets into the Privacy Cash pool for unlinkable transfers.
  - Withdraw: move funds back from Privacy Cash to any address, with retry logic for issues like blockhash expiration.
  - Private balance: show a separate “private balance” based on Privacy Cash UTXOs.

Normal Wallet Behavior
----------------------
- Even without using Privacy Cash explicitly, Veil improves privacy by:
  - Using burner wallets for dApp connections instead of the main wallet.
  - Avoiding address reuse across different sites.
  - Keeping all keys local and never sending them to a backend.
- A background balance monitor periodically checks on-chain balances and updates the UI.
- SOL/USD pricing is fetched via public APIs for better UX.

User Flow with dApps
--------------------
1. The content script injects a provider into the page that plugs into window.solana.providers, coexisting with wallets like Phantom.
2. When a dApp calls connect:
   - If the wallet is locked, the extension popup opens and waits for the user to unlock.
   - Veil creates a pending connection request and surfaces an approval modal.
   - On approval, Veil binds the site to a burner wallet and returns that burner’s public key.
3. After connection:
   - getAccount returns the burner address for that origin.
   - disconnect removes the site from the connected list.
   - signMessage queues a pending sign request that the user must approve in the popup; signing happens with the burner key.
   - signTransaction / signAllTransactions are stubbed as “coming soon” to keep the current release safe and focused.

Architecture
------------
- Manifest V3 extension:
  - Background service worker:
    - Runs the balance monitor.
    - Manages which origins are connected to which burner wallets.
    - Handles provider RPC methods and orchestrates unlock/approval flows.
  - Content script:
    - Injects the provider script into the page (avoiding CSP issues).
    - Bridges messages between the injected provider and the background script.
  - Popup UI (React app):
    - Onboarding: create/import master seed and set password.
    - Home: show active burner wallet, balances (public and private), and quick actions.
    - Settings: toggle Privacy Cash mode, configure behavior, manage preferences.
    - History and Archived Wallets: view activity and retired burner wallets.

Tech Stack
----------
- Frontend/Popup: React, Vite, TailwindCSS, Framer Motion.
- Blockchain: @solana/web3.js, BIP39 + Ed25519 HD derivation, tweetnacl.
- Privacy: Privacy Cash SDK for deposits/withdrawals into an external privacy pool.
- Extension Platform: Chrome Manifest V3, service worker background, content scripts, chrome.storage for encrypted state and session data.
- Language/Tooling: TypeScript, ESLint.

Positioning
-----------
- Category: Privacy tooling for Solana, not a mixer or custodial service.
- Key value proposition: “Connect anywhere without risking your main wallet,” with privacy enforced by design (burners + default-on Privacy Cash mode) rather than relying on user discipline.

